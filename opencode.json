{
  // â”€â”€ Schema & providers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "$schema": "https://opencode.ai/config.json",
  "model": "{env:OPENCODE_DEFAULT_MODEL}",
  "small_model": "{env:OPENCODE_SMALL_MODEL}",
  // Default agent at startup â€” full orchestrator for all tasks.
  "default_agent": "build",

  // â”€â”€ TUI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "tui": {
    // macOS-style scroll acceleration (overrides scroll_speed when enabled)
    "scroll_acceleration": { "enabled": true },
    // auto = adapts to terminal width; stacked = single column always
    "diff_style": "auto"
  },

  // â”€â”€ Compaction (long sessions with build/debug agents) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "compaction": {
    "auto": true,
    "prune": true,
    // Token buffer to avoid overflow during compaction
    "reserved": 10000
  },

  // â”€â”€ MCP servers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "mcp": {
    // Brave Search â€” web search, news, images, videos, AI summarizer.
    // API key: export BRAVE_API_KEY="BSA-xxx..." in ~/.zshrc
    // Free tier: https://api-dashboard.search.brave.com/register
    "brave_search": {
      "type": "local",
      "command": ["npx", "-y", "@brave/brave-search-mcp-server"],
      "environment": {
        "BRAVE_API_KEY": "{env:BRAVE_API_KEY}"
      },
      "enabled": true
    },
    // GitLab MCP Server â€” https://docs.gitlab.com/user/gitlab_duo/mcp_server/
    // Auth: OAuth 2.0 Dynamic Client Registration (automatic on first use)
    "gitlab": {
      "type": "remote",
      "url": "https://gitlab.com/api/v4/mcp",
      "enabled": true
    },
    // Trivy MCP â€” filesystem, image and repository vulnerability scanning.
    // Requires: trivy CLI (brew install trivy) + plugin (trivy plugin install mcp)
    // Restricted globally â€” enabled only on @security agent.
    "trivy": {
      "type": "local",
      "command": ["trivy", "mcp"],
      "enabled": true
    },
    // Context7 MCP â€” up-to-date library docs and code examples resolver.
    // API key: export CONTEXT7_API_KEY="..." in ~/.zshrc
    // Docs: https://context7.com
    "context7": {
      "type": "remote",
      "url": "https://mcp.context7.com/mcp",
      "headers": {
        "Authorization": "Bearer {env:CONTEXT7_API_KEY}"
      },
      "enabled": true
    },
    // Kubernetes MCP â€” cluster management and resource inspection.
    // Requires: kubectl configured with the target context.
    // Restricted globally â€” enabled only on @devops and @debug agents.
    "kubernetes": {
      "type": "local",
      "command": ["npx", "-y", "mcp-server-kubernetes"],
      "enabled": true
    },

    // AWS Billing & Cost Management MCP â€” cost analysis, budgets, anomaly detection,
    // Savings Plans, Reserved Instances, Compute Optimizer, right-sizing recommendations.
    // Requires: AWS_PROFILE + AWS_REGION env vars. IAM perms: ce:*, budgets:*, compute-optimizer:*
    // Restricted globally â€” enabled only on @devops and @architect.
    "aws-cost": {
      "type": "local",
      "command": ["uvx", "awslabs.billing-cost-management-mcp-server@latest"],
      "environment": {
        "AWS_PROFILE": "{env:AWS_PROFILE}",
        "AWS_REGION": "{env:AWS_REGION}",
        "FASTMCP_LOG_LEVEL": "ERROR"
      },
      "enabled": true
    },

    // AWS Documentation MCP â€” latest AWS docs, API references, What's New posts.
    // Read-only. Enabled globally â€” agents must ask before use (like context7).
    "aws-docs": {
      "type": "local",
      "command": ["uvx", "awslabs.aws-documentation-mcp-server@latest"],
      "environment": {
        "AWS_DOCUMENTATION_PARTITION": "aws",
        "FASTMCP_LOG_LEVEL": "ERROR"
      },
      "enabled": true
    },

    // AWS API MCP (preview) â€” comprehensive AWS API interactions with CloudTrail audit.
    // Requires: AWS credentials in env (AWS_PROFILE or access keys).
    // Restricted globally â€” enabled only on @devops (high privilege).
    "aws-api": {
      "type": "local",
      "command": ["uvx", "mcp-proxy-for-aws@latest", "https://aws-mcp.us-east-1.api.aws/mcp"],
      "environment": {
        "AWS_PROFILE": "{env:AWS_PROFILE}",
        "AWS_REGION": "{env:AWS_REGION}"
      },
      "enabled": true
    },

    // Amazon EKS MCP â€” EKS cluster management, Kubernetes resources, CloudWatch, IAM.
    // Requires: AWS_PROFILE + AWS_REGION. Add --allow-write / --allow-sensitive-data-access
    // as args if write ops or pod log access is needed (disabled by default â€” production safety).
    // Restricted globally â€” enabled only on @devops and @debug.
    "eks": {
      "type": "local",
      "command": ["uvx", "awslabs.eks-mcp-server@latest"],
      "environment": {
        "AWS_PROFILE": "{env:AWS_PROFILE}",
        "AWS_REGION": "{env:AWS_REGION}",
        "FASTMCP_LOG_LEVEL": "ERROR"
      },
      "enabled": true
    },

    // Git MCP â€” semantic git operations (status, diff, log, show, blame, branch + write ops).
    // No --repository flag = defaults to process CWD (opencode's working directory).
    // Write tools (git_add, git_commit, git_reset, git_create_branch, git_checkout) are
    // disabled globally â€” only read tools are re-enabled per agent.
    // Enabled on @reviewer, @debug, @explore for read-only git context.
    "git": {
      "type": "local",
      "command": ["uvx", "mcp-server-git"],
      "enabled": true
    },

    // Filesystem MCP â€” structured file/directory operations beyond built-in read/edit/glob.
    // Adds: create_directory, move_file, directory_tree, search_files, get_file_info.
    // Allowed root: {env:HOME} â€” assumes env var expansion in command args (adjust if needed).
    // Restricted globally â€” enabled on implementation and docs agents only.
    "filesystem": {
      "type": "local",
      "command": ["npx", "-y", "@modelcontextprotocol/server-filesystem", "{env:HOME}"],
      "enabled": true
    }
  },

  // â”€â”€ Global tool restrictions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // GitLab, Trivy and Kubernetes are disabled globally â€” re-enabled per agent below.
  // Brave Search and Context7 are enabled globally.
  // POLICY: agents MUST ask the user before invoking brave_search or context7 tools
  //         (limited API quota â€” never call them automatically).
  "tools": {
    "gitlab_*": false,
    "trivy_*": false,
    "mcp__kubernetes__*": false,
    // AWS tools restricted globally â€” re-enabled per agent below.
    // aws-docs is globally enabled (read-only, ask-first policy enforced via prompts).
    "mcp__aws-cost__*": false,
    "mcp__aws-api__*": false,
    "mcp__eks__*": false,
    // Git MCP â€” disabled globally, re-enabled (read-only) on @reviewer, @debug, @explore.
    // Write tools blocked globally even on agents that have the server enabled.
    "mcp__git__*": false,
    "mcp__git__git_commit": false,
    "mcp__git__git_add": false,
    "mcp__git__git_reset": false,
    "mcp__git__git_create_branch": false,
    "mcp__git__git_checkout": false,
    // Filesystem MCP â€” disabled globally, re-enabled on implementation and docs agents.
    "mcp__filesystem__*": false
  },

  // â”€â”€ Global permissions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "permission": {
    // Protect .env files from accidental reads
    "read": {
      "*": "allow",
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.example": "allow"
    },
    // Bash: very restrictive â€” only read-only git introspection and search allowed.
    // Everything else requires explicit user approval.
    "bash": {
      "*": "ask",
      "git status*": "allow",
      "git diff*": "allow",
      "git log*": "allow",
      "grep *": "allow",
      "rg *": "allow",
      // Destructive commands always denied at global level
      "git push*": "deny",
      "rm -rf*": "deny"
    },
    // Doom loop: ask the user instead of silently denying
    "doom_loop": "ask"
  },

  // â”€â”€ Custom slash commands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "command": {
    // /commit â€” MiniMax M2.5 Free (cheapest) is sufficient for commit message generation
    "commit": {
      "template": "Generate a conventional commit message for the current changes. Run git diff --cached first (staged). If empty, run git diff (unstaged) and git log -5 --oneline for context. Output only the commit message â€” no explanation, no preamble.",
      "description": "Generate conventional commit message from current changes",
      "agent": "mini"
    },
    // /search â€” Full Brave Search synthesis via @build
    "search": {
      "template": "Perform a thorough web search on: {{input}}. Use brave_web_search to find the most relevant and up-to-date information. If relevant, also use brave_news_search for recent news and updates. Synthesize the results in a clear, structured format with sources (URLs). If a result warrants deeper reading, use webfetch to retrieve the full page content.",
      "description": "Web search via Brave Search â€” structured synthesis with sources",
      "agent": "build"
    },
    // /review â€” Full review pipeline: explore â†’ review â†’ security if needed
    "review": {
      "template": "Review the following code changes thoroughly. First analyze with @explore to understand the scope, then provide a detailed code review following the team's conventions. If you spot security concerns, escalate to @security. Target: {{input}}",
      "description": "Full code review pipeline (explore â†’ review â†’ security if needed)",
      "agent": "build"
    },
    // /audit â€” Security audit pipeline: explore â†’ security â†’ report
    "audit": {
      "template": "Perform a comprehensive security audit of: {{input}}. Start with @explore to map the attack surface, then use @security for deep analysis. Report findings with severity levels (ğŸ”´ Critical | ğŸŸ¡ Important | ğŸŸ¢ Suggestion).",
      "description": "Security audit pipeline (explore â†’ security â†’ report)",
      "agent": "build"
    },
    // /debug â€” Full debug pipeline: diagnose â†’ fix â†’ verify
    "debug": {
      "template": "Investigate and diagnose the following issue: {{input}}. Delegate to @debug for systematic root cause analysis â€” reproduce, observe, hypothesize, verify. After diagnosis, coordinate the fix with the appropriate specialist and verify resolution with @tester.",
      "description": "Debug pipeline (debug â†’ fix â†’ verify)",
      "agent": "build"
    },
    // /test â€” Test coverage analysis and gap filling
    "test": {
      "template": "Analyze the test coverage and quality for: {{input}}. Use @explore to map existing tests, then @tester to identify gaps, suggest new test cases, and implement the most critical missing tests. Run the test suite to validate.",
      "description": "Test analysis and gap filling",
      "agent": "build"
    },
    // /document â€” Auto-documentation pipeline: explore â†’ docs
    "document": {
      "template": "Generate or update documentation for: {{input}}. Analyze the code first with @explore, then delegate to @docs to create clear, practical documentation adapted to the project's audience.",
      "description": "Auto-documentation pipeline (explore â†’ docs)",
      "agent": "build"
    },
    // /refactor â€” Guided refactoring: architect â†’ reviewer â†’ implement â†’ verify
    "refactor": {
      "template": "Analyze {{input}} for refactoring opportunities. Use @architect for design decisions, @reviewer for code quality assessment. Plan the refactoring in phases, implement improvements with tests, and verify no orphaned references with @explore.",
      "description": "Guided refactoring pipeline (architect â†’ reviewer â†’ implement â†’ verify)",
      "agent": "build"
    },
    // /onboard â€” Codebase onboarding: explore â†’ architect â†’ docs
    "onboard": {
      "template": "Create an onboarding guide for this codebase focusing on: {{input}}. Use @explore to map the project structure, @architect to explain key design decisions, and @docs to produce a clear onboarding document.",
      "description": "Codebase onboarding pipeline (explore â†’ architect â†’ docs)",
      "agent": "build"
    },
    // â”€â”€ Brainstorm commands (3 models: Claude Opus 4.6 Â· GPT-5.3-Codex Â· MiniMax M2.5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Each command maps to one of the 5 Mysti-inspired collaboration strategies.
    // All are MANUAL ONLY â€” never invoked automatically by other agents.
    //
    // /brainstorm-quick      â€” 3 calls Â· fast idea clash Â· direct synthesis
    // /brainstorm-debate     â€” 6 calls Â· positions + defense rounds Â· convergence check
    // /brainstorm-redteam    â€” 6 calls Â· propose + dual attack (tech + ops) + harden + verify
    // /brainstorm-perspectives â€” 3 calls Â· risk / opportunity / business-reality lenses
    // /brainstorm-delphi     â€” 6â€“8 calls Â· iterative consensus Â· ARCH-C mediates convergence
    "brainstorm-quick": {
      "template": "Run an architectural brainstorm using the QUICK strategy on: {{input}}. Strategy: Quick â€” 3 agent calls total, 1 round each. ARCH-A (Pragmatist) presents their approach first. ARCH-B (Innovator) challenges and proposes an alternative (receives A's output). ARCH-C (Contrarian) challenges both and surfaces the key assumption neither stated (receives A+B outputs). Then synthesize immediately with a Decision Log and Risk table.",
      "description": "Brainstorm Quick â€” 3 agents Â· 1 round each Â· fast synthesis",
      "agent": "architect-brainstorm"
    },
    "brainstorm-debate": {
      "template": "Run an architectural brainstorm using the DEBATE strategy on: {{input}}. Strategy: Debate â€” 6 agent calls, 2 rounds. Round 1: ARCH-A presents â†’ ARCH-B challenges with alternative â†’ ARCH-C challenges both and identifies blind spots. Round 2: ARCH-A defends/adapts against B and C â†’ ARCH-B refines final position against A's defense and C's critique â†’ ARCH-C scores convergence (0â€“10) and flags remaining sticking point. Synthesize with Decision Log and Risk table.",
      "description": "Brainstorm Debate â€” 3 agents Â· 2 rounds Â· convergence score from ARCH-C",
      "agent": "architect-brainstorm"
    },
    "brainstorm-redteam": {
      "template": "Run an architectural brainstorm using the RED-TEAM strategy on: {{input}}. Strategy: Red-Team â€” 6 agent calls. Round 1: ARCH-A proposes a concrete design â†’ ARCH-B attacks with technical threats and failure modes (receives A) â†’ ARCH-C attacks with operational, organizational and business risk threats (receives A+B). Round 2: ARCH-A hardens the proposal against all attacks from B and C â†’ ARCH-B verifies technical risk coverage in the hardened design â†’ ARCH-C verifies operational/business risk coverage. Synthesize the hardened architecture with Decision Log and Risk table.",
      "description": "Brainstorm Red-Team â€” propose + dual attack (technical + operational) + harden + verify",
      "agent": "architect-brainstorm"
    },
    "brainstorm-perspectives": {
      "template": "Run an architectural brainstorm using the PERSPECTIVES strategy on: {{input}}. Strategy: Perspectives â€” 3 agent calls, one per lens. ARCH-A (risk lens): enumerate everything that could go wrong with each option â€” failure modes, hidden costs, team risks. ARCH-B (opportunity lens): innovation potential, ecosystem leverage, future optionality (receives A). ARCH-C (business reality lens): team capability, timeline, budget, org constraints, vendor lock-in (receives A+B). Synthesize all three lenses into a balanced recommendation with Decision Log and Risk table.",
      "description": "Brainstorm Perspectives â€” risk lens / opportunity lens / business-reality lens",
      "agent": "architect-brainstorm"
    },
    "brainstorm-delphi": {
      "template": "Run an architectural brainstorm using the DELPHI strategy on: {{input}}. Strategy: Delphi â€” 6 to 8 agent calls with iterative convergence, ARCH-C as mediator. Round 1: ARCH-A initial proposal â†’ ARCH-B refines or diverges (receives A) â†’ ARCH-C mediates: identifies common ground, key divergences, and asks the clarifying question neither answered (receives A+B). Round 2: ARCH-A incorporates B's valid points and responds to C's mediation â†’ ARCH-B final position (receives A R2 + C R1) â†’ ARCH-C scores convergence: if â‰¥7/10 proceed to synthesis; otherwise add Round 3 (ARCH-A final concessions â†’ ARCH-B final acceptance). Synthesize when convergence is reached, with Decision Log and Risk table.",
      "description": "Brainstorm Delphi â€” iterative consensus Â· ARCH-C mediates Â· converges at â‰¥7/10",
      "agent": "architect-brainstorm"
    }
  },

  // â”€â”€ Agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Permission profiles (implicit â€” not a config key, for documentation only):
  //
  //   readonly    bash:deny, edit:deny, read:allow          â†’ plan, explore, reviewer, debug
  //   implementer bash:ask,  edit:allow, read:allow         â†’ build, backend, frontend, docs
  //   operator    bash:allow(scoped), edit:allow, read:allow â†’ devops, architect (infra writes)
  //   restricted  bash:deny, edit:deny, read:deny            â†’ mini, gitlab-operator (curl-only)
  //
  // All agents inherit global deny-by-default; each profile adds only what is needed.
  "agent": {

    // â”€â”€â”€ Mini (MiniMax M2.5 Free â€” ultra-lightweight) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Fastest and cheapest agent. Only micro-tasks: single-line edits, commit
    // messages, quick Q&A. Can invoke @explore. Escalates to @build.
    "mini": {
      "description": "Ultra-lightweight agent via MiniMax M2.5 Free â€” tiny edits, commit messages, quick Q&A. Escalates to @build for non-trivial tasks.",
      "model": "{env:OPENCODE_MODEL_MINI}",
      "mode": "primary",
      "color": "#34D399",
      "temperature": 0.2,
      "steps": 15,
      "prompt": "{file:./prompts/mini.txt}",
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "git log*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "git push*": "deny",
          "rm -rf*": "deny"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "task": {
          // mini can only invoke lightweight read-only subagents
          "*": "deny",
          "explore": "allow"
        },
        "todowrite": "allow",
        "todoread": "allow",
        "question": "allow",
        "codesearch": "allow",
        "lsp": "allow",
        "webfetch": "deny",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Build (Sonnet 4.6 â€” full orchestrator) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Main entry point for complex multi-agent workflows.
    // Coordinates all specialists. Brave Search globally enabled â€” ask user before use.
    "build": {
      "description": "Lead engineer and orchestrator: decomposes work, delegates to specialist subagents and enforces cross-cutting consistency.",
      "model": "{env:OPENCODE_MODEL_BUILD}",
      "mode": "primary",
      "color": "#6366F1",
      "temperature": 0.3,
      "steps": 100,
      "prompt": "{file:./prompts/build.txt}",
      "tools": {
        "gitlab_*": true,
        "mcp__filesystem__*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "git log*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "git push*": "deny",
          "rm -rf*": "deny"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        // build can invoke all subagents
        "task": {
          "*": "allow"
        },
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Plan (Opus 4.6 â€” strategic planner, read-only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // High-capability strategic planner. Use for complex features and
    // architectural decisions. Brave Search globally enabled â€” ask user before use.
    "plan": {
      "description": "Strategic planner: analyzes requirements, decomposes tasks, identifies risks & dependencies. Read-only â€” no edits.",
      "model": "{env:OPENCODE_MODEL_PLAN}",
      "mode": "primary",
      "color": "#F97316",
      "temperature": 0.2,
      "steps": 40,
      "prompt": "{file:./prompts/plan.txt}",
      "tools": {
        "gitlab_*": true
      },
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "task": {
          "*": "deny",
          "explore": "allow"
        },
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "codesearch": "allow",
        "lsp": "allow"
      }
    },

    // â”€â”€â”€ Explore (MiniMax M2.5 Free â€” fast read-only codebase traversal) â”€â”€â”€â”€
    // Fastest agent for codebase exploration. Strictly read-only, no shell commands.
    "explore": {
      "description": "Fast codebase explorer via MiniMax M2.5 Free. Read-only grep/glob â€” no edits, no shell.",
      "model": "{env:OPENCODE_MODEL_EXPLORE}",
      "mode": "subagent",
      "color": "#84CC16",
      "temperature": 0.0,
      "steps": 40,
      "prompt": "{file:./prompts/explore.txt}",
      "tools": {
        // Read-only git context (log, blame, diff) â€” write tools blocked globally
        "mcp__git__*": true
      },
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow"
      }
    },

    // â”€â”€â”€ Debug (Opus 4.6 â€” diagnostic specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Root cause analysis only â€” never fixes, only diagnoses and hands off.
    // High-capability model justified by complex multi-hypothesis reasoning.
    "debug": {
      "description": "Diagnostic specialist: root cause analysis, stack trace interpretation, profiling, observability â€” diagnosis only, then handoff to specialists for fixes.",
      "model": "{env:OPENCODE_MODEL_DEBUG}",
      "mode": "subagent",
      "color": "#F43F5E",
      "temperature": 0.1,
      "steps": 70,
      "prompt": "{file:./prompts/debug.txt}",
      "tools": {
        "mcp__kubernetes__*": true,
        "mcp__eks__*": true,
        "mcp__git__*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "git log*": "allow",
          "git bisect*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          // Allow test/profiling commands for reproduction
          "npm test*": "allow",
          "npm run test*": "allow",
          "pytest*": "allow",
          "python -m pytest*": "allow",
          "go test*": "allow",
          "cargo test*": "allow",
          "rm -rf*": "deny",
          "git push*": "deny"
        },
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Backend (Sonnet 4.6 â€” server-side specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "backend": {
      "description": "Backend specialist: REST/GraphQL APIs, databases, microservices, performance and server-side architecture.",
      "model": "{env:OPENCODE_MODEL_BACKEND}",
      "mode": "subagent",
      "color": "#3B82F6",
      "temperature": 0.3,
      "steps": 65,
      "prompt": "{file:./prompts/backend.txt}",
      "tools": {
        "mcp__filesystem__*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "git log*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "npm test*": "allow",
          "npm run test*": "allow",
          "npx vitest*": "allow",
          "pytest*": "allow",
          "python -m pytest*": "allow",
          "go test*": "allow",
          "cargo test*": "allow",
          "npm run lint*": "allow",
          "ruff check*": "allow",
          "golangci-lint*": "allow",
          "cargo clippy*": "allow",
          "rm -rf*": "deny",
          "git push*": "deny",
          "git commit*": "ask"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Frontend (Sonnet 4.6 â€” UI/UX specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "frontend": {
      "description": "Frontend specialist: UI/UX, React/Vue/Angular components, CSS, accessibility and web performance.",
      "model": "{env:OPENCODE_MODEL_FRONTEND}",
      "mode": "subagent",
      "color": "#A855F7",
      "temperature": 0.4,
      "steps": 60,
      "prompt": "{file:./prompts/frontend.txt}",
      "tools": {
        "mcp__filesystem__*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "npm test*": "allow",
          "npm run test*": "allow",
          "npx vitest*": "allow",
          "npx playwright*": "allow",
          "npm run lint*": "allow",
          "npm run build*": "ask",
          "rm -rf*": "deny",
          "git push*": "deny",
          "git commit*": "ask"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Security (Opus 4.6 â€” cybersecurity specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Opus justified: complex multi-vector threat analysis.
    // Has exclusive access to Trivy MCP tools for container/repo scanning.
    // edit is "ask" â€” requires explicit approval before any file modification.
    "security": {
      "description": "Cybersecurity expert: code auditing, OWASP Top 10, vulnerability detection, hardening, compliance and Trivy MCP scanning.",
      "model": "{env:OPENCODE_MODEL_SECURITY}",
      "mode": "subagent",
      "color": "#EF4444",
      "temperature": 0.0,
      "steps": 60,
      "prompt": "{file:./prompts/security.txt}",
      "tools": {
        "trivy_*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git log*": "allow",
          "git diff*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "rm -rf*": "deny",
          "git push*": "deny"
        },
        "edit": "ask",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow"
      }
    },

    // â”€â”€â”€ DevOps (Sonnet 4.6 â€” CI/CD and infrastructure specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Has GitLab access for pipeline management.
    "devops": {
      "description": "DevOps/SRE expert: CI/CD pipelines, containers, Kubernetes, IaC (Terraform), observability and reliability.",
      "model": "{env:OPENCODE_MODEL_DEVOPS}",
      "mode": "subagent",
      "color": "#22C55E",
      "temperature": 0.2,
      "steps": 70,
      "prompt": "{file:./prompts/devops.txt}",
      "tools": {
        "gitlab_*": true,
        "mcp__kubernetes__*": true,
        "mcp__aws-cost__*": true,
        "mcp__aws-api__*": true,
        "mcp__eks__*": true,
        "mcp__filesystem__*": true
      },
      "permission": {
        "bash": {
          "*": "ask",
          "git status*": "allow",
          "git diff*": "allow",
          "git log*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "docker ps*": "allow",
          "docker images*": "allow",
          "kubectl get*": "allow",
          "kubectl describe*": "allow",
          "terraform plan*": "allow",
          "terraform validate*": "allow",
          "rm -rf*": "deny",
          "git push*": "deny",
          "kubectl delete*": "ask",
          "terraform apply*": "ask",
          "terraform destroy*": "deny"
        },
        "task": {
          "*": "deny",
          "gitlab-operator": "allow"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "lsp": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ Reviewer (Sonnet 4.6 â€” code review specialist, read-only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "reviewer": {
      "description": "Code reviewer: PR/MR analysis, code quality, conventions, technical debt and constructive feedback â€” read-only.",
      "model": "{env:OPENCODE_MODEL_REVIEWER}",
      "mode": "subagent",
      "color": "#F59E0B",
      "temperature": 0.1,
      "steps": 40,
      "prompt": "{file:./prompts/reviewer.txt}",
      "tools": {
        // Git history and blame for richer review context â€” write tools blocked globally
        "mcp__git__*": true
      },
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "task": {
          "*": "deny",
          "gitlab-operator": "allow"
        }
      }
    },

    // â”€â”€â”€ Architect (Opus 4.6 â€” system design and ADRs) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Opus justified: deep trade-off reasoning and long-horizon design decisions.
    // edit is "ask" â€” only for writing ADR files, not implementation code.
    "architect": {
      "description": "Software architect: system design, architectural patterns, ADRs, scalability and technology selection.",
      "model": "{env:OPENCODE_MODEL_ARCHITECT}",
      "mode": "subagent",
      "color": "#06B6D4",
      "temperature": 0.5,
      "steps": 60,
      "prompt": "{file:./prompts/architect.txt}",
      "tools": {
        // Cost data for cost-aware architectural decisions
        "mcp__aws-cost__*": true
      },
      "permission": {
        "bash": "deny",
        "edit": "ask",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "lsp": "allow"
      }
    },

    // â”€â”€â”€ Architect-Brainstorm (Opus 4.6 â€” orchestrator) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MANUAL ONLY â€” only reachable via /brainstorm. Never invoked automatically.
    // Orchestrates @arch-pragmatist (Claude Opus 4.6) vs @arch-innovator (GPT-5.3-Codex)
    // vs @arch-contrarian (MiniMax M2.5) across 5 strategies.
    "architect-brainstorm": {
      "description": "Brainstorm orchestrator: coordinates @arch-pragmatist vs @arch-innovator vs @arch-contrarian across 5 strategies, then synthesizes. Manual only â€” /brainstorm command only.",
      "model": "{env:OPENCODE_MODEL_ARCHITECT}",
      "mode": "subagent",
      "color": "#0EA5E9",
      "temperature": 0.5,
      "steps": 70,
      "prompt": "{file:./prompts/architect-brainstorm.txt}",
      "permission": {
        "bash": "deny",
        "edit": "ask",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "task": {
          // orchestrator can invoke the three debate personas + explore for pre-debate codebase mapping
          "*": "deny",
          "arch-pragmatist": "allow",
          "arch-innovator": "allow",
          "arch-contrarian": "allow",
          "explore": "allow"
        }
      }
    },

    // â”€â”€â”€ Arch-Pragmatist (Claude Opus 4.6 â€” Pragmatist debate persona) â”€â”€â”€â”€â”€â”€â”€â”€
    // Subagent of architect-brainstorm only. Never invoked by any other agent.
    "arch-pragmatist": {
      "description": "Brainstorm persona: Pragmatist architect â€” simplicity, TCO, proven patterns. Only invoked by @architect-brainstorm.",
      "model": "{env:OPENCODE_MODEL_ARCH_PRAGMATIST}",
      "mode": "subagent",
      "color": "#64748B",
      "temperature": 0.3,
      "steps": 30,
      "prompt": "{file:./prompts/arch-pragmatist.txt}",
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "webfetch": "allow",
        "question": "allow"
      }
    },

    // â”€â”€â”€ Arch-Innovator (GPT-5.3-Codex â€” Innovator debate persona) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Subagent of architect-brainstorm only. Never invoked by any other agent.
    "arch-innovator": {
      "description": "Brainstorm persona: Innovator architect â€” scalability, modern patterns, future-proofing. Only invoked by @architect-brainstorm.",
      "model": "{env:OPENCODE_MODEL_ARCH_INNOVATOR}",
      "mode": "subagent",
      "color": "#7C3AED",
      "temperature": 0.8,
      "steps": 30,
      "prompt": "{file:./prompts/arch-innovator.txt}",
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "webfetch": "allow",
        "question": "allow"
      }
    },

    // â”€â”€â”€ Arch-Contrarian (MiniMax M2.5 â€” Contrarian debate persona) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Subagent of architect-brainstorm only. Never invoked by any other agent.
    // Challenges assumptions, surfaces blind spots, brings business/operational reality.
    // Uses MiniMax M2.5 â€” set OPENCODE_MODEL_ARCH_CONTRARIAN to your MiniMax M2.5 model ID.
    "arch-contrarian": {
      "description": "Brainstorm persona: Contrarian â€” challenges assumptions of both architects, surfaces blind spots, business/operational reality check. Only invoked by @architect-brainstorm.",
      "model": "{env:OPENCODE_MODEL_ARCH_CONTRARIAN}",
      "mode": "subagent",
      "color": "#F97316",
      "temperature": 0.7,
      "steps": 25,
      "prompt": "{file:./prompts/arch-contrarian.txt}",
      "permission": {
        "bash": "deny",
        "edit": "deny",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "webfetch": "allow",
        "question": "allow"
      }
    },

    // â”€â”€â”€ Tester (Sonnet 4.6 â€” QA and test strategy specialist) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "tester": {
      "description": "QA/testing expert: test strategy, TDD/BDD, unit, integration, E2E and performance testing.",
      "model": "{env:OPENCODE_MODEL_TESTER}",
      "mode": "subagent",
      "color": "#10B981",
      "temperature": 0.2,
      "steps": 60,
      "prompt": "{file:./prompts/tester.txt}",
      "permission": {
        "bash": {
          "*": "ask",
          "npm test*": "allow",
          "npm run test*": "allow",
          "npx vitest*": "allow",
          "npx jest*": "allow",
          "npx playwright*": "allow",
          "pytest*": "allow",
          "python -m pytest*": "allow",
          "go test*": "allow",
          "cargo test*": "allow",
          "grep *": "allow",
          "rg *": "allow",
          "git diff*": "allow",
          "rm -rf*": "deny",
          "git push*": "deny",
          "git commit*": "ask"
        },
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "lsp": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "question": "allow",
        "doom_loop": "ask"
      }
    },

    // â”€â”€â”€ GitLab (MiniMax M2.5 Free â€” GitLab REST API write operator) â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Dual-path pattern:
    //   READ  operations (MR details, pipelines, issues) â†’ use gitlab_* MCP tools
    //   WRITE operations (MR comments, labels, approvals) â†’ delegate to @gitlab-operator
    // Thin wrapper around curl + GITLAB_PERSONAL_ACCESS_TOKEN.
    // The MCP remote server does not reliably support write operations.
    // curl is restricted to gitlab.com/api/* only â€” no other domains allowed.
    "gitlab-operator": {
      "description": "GitLab REST API write operator: posts MR comments, labels and approvals via curl + GITLAB_PERSONAL_ACCESS_TOKEN. Use when MCP write operations fail.",
      "model": "{env:OPENCODE_MODEL_GITLAB_OPERATOR}",
      "mode": "subagent",
      "color": "#FC6D26",
      "temperature": 0.0,
      "steps": 20,
      "prompt": "{file:./prompts/gitlab.txt}",
      "permission": {
        "bash": {
          "*": "deny",
          "curl --*gitlab.com/api*": "allow",
          "git remote*": "allow",
          "git log*": "allow",
          "git rev-parse*": "allow"
        },
        "edit": "deny",
        "read": "deny",
        "glob": "deny",
        "grep": "deny",
        "webfetch": "deny",
        "question": "allow"
      }
    },

    // â”€â”€â”€ Docs (MiniMax M2.5 Free â€” technical writer) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MiniMax M2.5 Free is sufficient for documentation tasks (low reasoning complexity).
    "docs": {
      "description": "Technical writer: READMEs, JSDoc/TSDoc, guides, ADRs, changelogs and API docs (OpenAPI/AsyncAPI).",
      "model": "{env:OPENCODE_MODEL_DOCS}",
      "mode": "subagent",
      "color": "#8B5CF6",
      "temperature": 0.3,
      "steps": 40,
      "tools": {
        "mcp__filesystem__*": true
      },
      "prompt": "{file:./prompts/docs.txt}",
      "permission": {
        "bash": "deny",
        "edit": "allow",
        "read": "allow",
        "glob": "allow",
        "grep": "allow",
        "codesearch": "allow",
        "todowrite": "allow",
        "todoread": "allow",
        "webfetch": "allow",
        "lsp": "allow",
        "question": "allow"
      }
    }
  },

  // â”€â”€ Keybinds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Leader key: ctrl+x
  //   ctrl+x â†’ / â†  : cycle child sessions (subagent sessions)
  //   ctrl+x n       : new session
  //   ctrl+x a       : agent list (Tab also cycles primary agents)
  "keybinds": {
    "leader": "ctrl+x"
  }
}
